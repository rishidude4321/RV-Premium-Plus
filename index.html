<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RV Premium Plus | Ultra Edition</title>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --card-bg: #141414;
            --text-color: #ffffff;
            --accent-color: #00a4dc;
            --secondary-text: #aaa;
        }

        .light-mode {
            --bg-color: #f4f4f4;
            --card-bg: #ffffff;
            --text-color: #1a1a1a;
            --accent-color: #007bb5;
            --secondary-text: #555;
        }

        body { background: var(--bg-color); color: var(--text-color); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; transition: 0.3s; }
        
        /* Navbar & Profile Section */
        nav { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; background: rgba(0,0,0,0.5); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(10px); }
        .nav-right { display: flex; align-items: center; gap: 20px; }
        .profile-badge { width: 40px; height: 40px; border-radius: 50%; background: var(--accent-color); display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; }
        
        header { padding: 20px; text-align: center; }
        h1 { color: var(--accent-color); font-size: 2.2rem; margin-bottom: 10px; }

        /* Controls Area */
        .controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 30px; }
        input, select, .ctrl-btn { padding: 10px 15px; border-radius: 20px; border: 1px solid #333; background: var(--card-bg); color: var(--text-color); outline: none; }
        .ctrl-btn { cursor: pointer; border-color: var(--accent-color); font-weight: bold; }
        .ctrl-btn:hover { background: var(--accent-color); color: white; }

        /* Rows */
        .category-section { margin-bottom: 30px; padding-left: 40px; }
        .category-title { font-size: 1.4rem; margin-bottom: 10px; font-weight: 600; }
        .movie-row { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 15px; }
        .movie-row::-webkit-scrollbar { display: none; }

        .movie-card { flex: 0 0 180px; background: var(--card-bg); border-radius: 8px; overflow: hidden; transition: 0.3s; cursor: pointer; border: 1px solid #333; }
        .movie-card:hover { transform: scale(1.08); border-color: var(--accent-color); }
        .movie-card img { width: 100%; height: 260px; object-fit: cover; }
        .info { padding: 10px; text-align: center; }
        .title { font-size: 0.85rem; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Modal Enhancements */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); overflow-y: auto; }
        .modal-content { background: var(--card-bg); margin: 2% auto; padding: 30px; width: 90%; max-width: 1000px; border-radius: 15px; position: relative; display: flex; gap: 30px; flex-wrap: wrap; }
        .modal-left { flex: 1; min-width: 300px; }
        .modal-left img { width: 100%; border-radius: 10px; }
        .modal-right { flex: 2; min-width: 300px; }
        
        .cast-row { display: flex; gap: 10px; overflow-x: auto; margin-top: 15px; }
        .cast-card { flex: 0 0 80px; text-align: center; font-size: 0.7rem; }
        .cast-card img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; }

        .rating-badge { display: inline-block; padding: 5px 10px; border-radius: 5px; font-weight: bold; margin-right: 10px; background: #333; }
        .tomato { color: #ff3131; } .critic { color: #ffcc00; }

        #qr-container { text-align: center; margin-top: 20px; padding: 20px; background: white; width: fit-content; margin: 20px auto; border-radius: 10px; display: none; }
    </style>
</head>
<body>

<nav>
    <div style="font-weight: bold; font-size: 1.5rem; color: var(--accent-color);">RV PLUS</div>
    <div class="nav-right">
        <button class="ctrl-btn" onclick="toggleTheme()">üåì Toggle Mode</button>
        <div class="profile-badge" onclick="switchUser()" id="userProfile">R</div>
    </div>
</nav>

<header>
    <h1>RV Premium Plus</h1>
    <div class="controls">
        <input type="text" id="search" placeholder="Search movies...">
        <select id="genreFilter" onchange="filterByGenre()">
            <option value="">All Genres</option>
            <option value="28">Action</option>
            <option value="35">Comedy</option>
            <option value="27">Horror</option>
            <option value="10749">Romance</option>
        </select>
        <button class="ctrl-btn" onclick="surpriseMe()">üé≤ Surprise Me</button>
        <button class="ctrl-btn" onclick="toggleQR()">üì± Show Mobile QR</button>
    </div>
</header>

<div id="qr-container">
    <div id="qrcode"></div>
    <p style="color: black; margin-top: 10px; font-weight: bold;">Scan to watch on phone!</p>
</div>

<div id="continueWatchingSection" class="category-section" style="display: none;">
    <div class="category-title">Continue Watching</div>
    <div id="continueRow" class="movie-row"></div>
</div>

<div id="myListSection" class="category-section" style="display: none;">
    <div class="category-title">My List</div>
    <div id="myListRow" class="movie-row"></div>
</div>

<div id="mainContent"></div>

<div id="movieModal" class="modal">
    <div class="modal-content">
        <span style="position:absolute; right:20px; top:10px; cursor:pointer; font-size:2rem;" onclick="closeModal()">&times;</span>
        <div class="modal-left" id="modalImg"></div>
        <div class="modal-right">
            <h2 id="modalTitle"></h2>
            <div id="modalRatings" style="margin-bottom: 15px;"></div>
            <p id="modalInfo" style="color: var(--secondary-text);"></p>
            <p id="modalOverview"></p>
            
            <h3>Top Cast</h3>
            <div id="modalCast" class="cast-row"></div>

            <div style="margin-top:20px; display:flex; gap:10px;">
                <button id="modalWatchBtn" class="ctrl-btn" style="background:var(--accent-color); color:white; padding:15px 30px;">‚ñ∂ WATCH NOW</button>
                <button id="addListBtn" class="ctrl-btn">Add to List</button>
                <div id="modalTrailer"></div>
            </div>

            <h3 style="margin-top:30px;">Similar Movies</h3>
            <div id="similarMoviesRow" class="movie-row"></div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
const API_KEY = '31b33cade35075a7a011c88568bb1070';
const IMG_PATH = 'https://image.tmdb.org/t/p/w500';

let myList = JSON.parse(localStorage.getItem('myList')) || [];
let continueWatching = JSON.parse(localStorage.getItem('continueWatching')) || [];
let currentUser = "Rishi";

async function init() {
    document.getElementById('mainContent').innerHTML = '';
    const sections = [
        { name: 'Recently Added', url: `https://api.themoviedb.org/3/movie/now_playing?api_key=${API_KEY}` },
        { name: 'Trending Now', url: `https://api.themoviedb.org/3/trending/movie/day?api_key=${API_KEY}` }
    ];
    for (const s of sections) {
        const res = await fetch(s.url);
        const data = await res.json();
        renderRow(s.name, data.results, document.getElementById('mainContent'));
    }
    updateLists();
}

function renderRow(title, movies, container) {
    const div = document.createElement('div');
    div.className = 'category-section';
    div.innerHTML = `<div class="category-title">${title}</div><div class="movie-row">${movies.map(m => `
        <div class="movie-card" onclick="showDetails(${m.id})">
            <img src="${IMG_PATH + m.poster_path}">
            <div class="info"><div class="title">${m.title}</div></div>
        </div>`).join('')}</div>`;
    container.appendChild(div);
}

async function showDetails(id) {
    const res = await fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${API_KEY}&append_to_response=videos,credits,similar`);
    const movie = await res.json();

    document.getElementById('modalTitle').innerText = movie.title;
    document.getElementById('modalImg').innerHTML = `<img src="${IMG_PATH + movie.poster_path}">`;
    document.getElementById('modalOverview').innerText = movie.overview;
    
    // Ratings
    const tomatoScore = Math.floor(movie.vote_average * 10);
    document.getElementById('modalRatings').innerHTML = `
        <span class="rating-badge tomato">üçÖ ${tomatoScore}%</span>
        <span class="rating-badge critic">‚≠ê ${movie.vote_average}/10</span>
    `;

    // Cast
    document.getElementById('modalCast').innerHTML = movie.credits.cast.slice(0, 8).map(c => `
        <div class="cast-card">
            <img src="${c.profile_path ? IMG_PATH + c.profile_path : 'https://via.placeholder.com/60'}">
            <p>${c.name}</p>
        </div>`).join('');

    // Similar
    document.getElementById('similarMoviesRow').innerHTML = movie.similar.results.slice(0, 6).map(m => `
        <div class="movie-card" style="flex: 0 0 120px;" onclick="showDetails(${m.id})">
            <img src="${IMG_PATH + m.poster_path}" style="height:180px;">
        </div>`).join('');

    // Buttons
    const streamUrl = `https://rivestream.org/embed?type=movie&id=${id}`;
    document.getElementById('modalWatchBtn').onclick = () => {
        addToContinue(movie);
        window.open(streamUrl, '_blank');
    };

    const trailer = movie.videos.results.find(v => v.type === 'Trailer');
    document.getElementById('modalTrailer').innerHTML = trailer ? `<button class="ctrl-btn" onclick="window.open('https://youtube.com/watch?v=${trailer.key}')">üì∫ Trailer</button>` : '';

    const addBtn = document.getElementById('addListBtn');
    addBtn.onclick = () => toggleMyList(movie);
    addBtn.innerText = myList.some(m => m.id === movie.id) ? "Remove from List" : "Add to List";

    document.getElementById('movieModal').style.display = 'block';
}

function addToContinue(movie) {
    continueWatching = [movie, ...continueWatching.filter(m => m.id !== movie.id)].slice(0, 10);
    localStorage.setItem('continueWatching', JSON.stringify(continueWatching));
    updateLists();
}

function toggleMyList(movie) {
    if(myList.some(m => m.id === movie.id)) {
        myList = myList.filter(m => m.id !== movie.id);
    } else {
        myList.push(movie);
    }
    localStorage.setItem('myList', JSON.stringify(myList));
    updateLists();
    closeModal();
}

function updateLists() {
    const cwRow = document.getElementById('continueRow');
    const mlRow = document.getElementById('myListRow');
    
    if(continueWatching.length > 0) {
        document.getElementById('continueWatchingSection').style.display = 'block';
        cwRow.innerHTML = continueWatching.map(m => `<div class="movie-card" onclick="showDetails(${m.id})"><img src="${IMG_PATH + m.poster_path}"></div>`).join('');
    }
    if(myList.length > 0) {
        document.getElementById('myListSection').style.display = 'block';
        mlRow.innerHTML = myList.map(m => `<div class="movie-card" onclick="showDetails(${m.id})"><img src="${IMG_PATH + m.poster_path}"></div>`).join('');
    }
}

function surpriseMe() {
    fetch(`https://api.themoviedb.org/3/movie/top_rated?api_key=${API_KEY}`).then(r => r.json()).then(d => {
        const random = d.results[Math.floor(Math.random() * d.results.length)];
        showDetails(random.id);
    });
}

function toggleTheme() { document.body.classList.toggle('light-mode'); }

function toggleQR() {
    const container = document.getElementById('qr-container');
    if(container.style.display === 'block') { container.style.display = 'none'; return; }
    container.style.display = 'block';
    document.getElementById('qrcode').innerHTML = '';
    
    // This now automatically detects your GitHub URL!
    new QRCode(document.getElementById("qrcode"), window.location.href);
}

function closeModal() { document.getElementById('movieModal').style.display = 'none'; }
init();
</script>
</body>
</html>